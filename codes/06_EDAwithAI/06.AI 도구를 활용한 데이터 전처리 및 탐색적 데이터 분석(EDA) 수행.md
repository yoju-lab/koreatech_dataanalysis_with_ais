## AI 도구를 활용한 데이터 전처리 및 탐색적 데이터 분석(EDA) 수행

이번 강의에서는 **실제 데이터셋을 가지고 AI의 도움을 받아 데이터 전처리와 탐색적 데이터 분석(EDA)을 수행**해보겠습니다. 이 강의는 앞서 배운 내용을 종합적으로 활용하게 될 것입니다.

### 시나리오 및 데이터 준비

실습에 사용할 데이터셋으로 **타이타닉 승객 생존 데이터**를 선정하겠습니다. 타이타닉 데이터셋은 매우 유명하며, 여러 컬럼을 포함하고 있어 전처리와 EDA 연습에 적합합니다. (만약 다른 데이터를 사용하고 싶다면 자유롭게 선택 가능합니다만, 예시에선 이해를 돕기 위해 타이타닉 데이터를 사용합니다.)

**타이타닉 데이터 요약:**  
- 각 행은 타이타닉호 탑승객 한 명에 대한 정보입니다.  
- 주요 컬럼:  
  - `Survived` : 생존 여부 (0 = 사망, 1 = 생존)  
  - `Pclass` : 승객 등급 (1, 2, 3등석)  
  - `Sex` : 성별 (male, female)  
  - `Age` : 나이 (일부 결측치 존재)  
  - `SibSp` : 함께 탑승한 형제자매/배우자 수  
  - `Parch` : 함께 탑승한 부모/자녀 수  
  - `Fare` : 티켓 요금  
  - `Embarked` : 탑승항구 (C, Q, S)  

우선 **파이썬 환경에서 타이타닉 데이터를 불러**오겠습니다. seaborn 라이브러리에 샘플 데이터로 포함되어 있으므로, seaborn을 이용해 가져오겠습니다. (환경에 따라 seaborn을 설치해야 할 수 있습니다: `pip install seaborn`)

```python
import seaborn as sns
import pandas as pd

# 타이타닉 데이터셋 로드
titanic_df = sns.load_dataset('titanic')
print(titanic_df.head())
print(titanic_df.shape)
print(titanic_df.columns)
```

위 코드를 실행하면 데이터프레임의 처음 다섯 행, shape (행열 크기), 컬럼명을 확인할 수 있습니다. **타이타닉 데이터에는 Age에 NaN(결측값)이 있고, Cabin 등 일부 컬럼에도 결측치가 많습니다.** 이러한 **전처리 필요성**이 있는 상태에서 EDA를 진행해야 합니다.

### 1. 데이터 전처리: 결측치 처리 (AI 도움)

먼저 **전처리 단계**입니다. 가장 눈에 띄는 것은 `Age` 컬럼의 결측치입니다. 약 20% 가량의 승객 나이가 누락되어 있는데, 이를 어떻게 처리할지 결정해야 합니다. 일반적인 방법으로는 평균이나 중앙값으로 채우기, 혹은 나이에 따라 그룹별 중앙값으로 채우기 등이 있습니다. 이 결정을 AI와 함께 해보겠습니다.

우리는 **"Age 컬럼의 NaN을 채우는 방법"**에 대해 AI에게 물어보고, 그에 맞는 **코드도 함께** 받아보겠습니다.

```python
na_request = (
    "타이타닉 생존자 데이터(titanic_df)가 있습니다. 이 데이터에서 Age 컬럼에 결측치가 다수 있습니다. "
    "분석을 위해 Age의 NaN 값을 채우려고 합니다. 어떤 방법들이 가능할까요? "
    "그리고 그 중 한 가지 방법(예: 중앙값으로 채우기)을 선택하여 pandas 코드로 보여주세요."
)
messages = [
    {"role": "user", "content": na_request}
]
response = client.chat.completions.create(model="gpt-4o-mini", messages=messages)
print(response.choices[0].message.content)
```

프롬프트 내용: **결측치 처리 방법**을 물어보고, **하나를 선택해 코드로 보여달라**고 요청했습니다. AI는 먼저 몇 가지 방법을 제안할 것입니다. 예를 들어:
- "평균으로 채우기"
- "중앙값으로 채우기"
- "유사한 승객 그룹(예: Pclass와 Sex 조합)의 평균으로 채우기"
- "별도의 값(-1 등)으로 표시하기" (권장되진 않지만 제시할 수 있음)
- "해당 행 제거" 등

그리고나서, 예를 들면 "중앙값으로 채우기"를 선택하여 코드 예제를 줄 것입니다. 예상되는 코드는 다음과 같을 수 있습니다:

```python
# Age 결측치를 Age 중앙값으로 채우기
median_age = titanic_df['age'].median()
titanic_df['age'] = titanic_df['age'].fillna(median_age)
```

또는 pandas의 `fillna(titanic_df['age'].median(), inplace=True)` 같은 한 줄로 처리하는 방법을 줄 수도 있습니다. AI가 이러한 코드를 제시하면, 우리는 이를 실행하여 실제로 결측치가 채워졌는지 확인할 수 있습니다.

한편, AI가 언급한 다른 방법들도 주목하세요. 예컨대 **승객 등급별 중앙값으로 채우기**는 조금 더 정교한 방법입니다. AI가 그런 아이디어를 냈다면, 추가 질문으로 "등급별로 다르게 채우는 코드를 달라"고 물어볼 수도 있습니다. 하지만 여기서는 일단 중앙값으로 일괄 채우는 것으로 진행하겠습니다 (실습 시간 관계상).

전처리의 다른 요소로 **불필요한 컬럼 제거**나 **범주형 변수 인코딩** 등이 있을 수 있지만, 이번 예제에선 크게 필요하지 않으므로 생략합니다. (Cabin 컬럼은 결측이 많아 분석에서 제외할 수 있고, Embarked 등 범주형은 시각화 시 자동 처리 가능)

### 2. 탐색적 데이터 분석 (EDA) : AI와 함께 진행

전처리가 완료되었으니 본격적으로 EDA를 시작합니다. EDA에서는 보통 **데이터의 분포와 관계를 파악**하게 됩니다. 타이타닉 데이터의 경우, 다음과 같은 질문들이 떠오를 수 있습니다:
- **단변수 분포:** 승객 나이 분포, 운임(Fare) 분포 등
- **이변수 분석:** 생존 여부에 따른 특성 차이 (생존자 vs 사망자의 평균 나이, 성별에 따른 생존율, 등급에 따른 생존율 등)
- **다변수 분석:** 여러 요소를 교차로 봤을 때 (예: 등급+성별별 생존율)

#### (a) EDA 방향 설정 아이디어 얻기

어떤 그래프나 분석을 할지 AI에게 물어보겠습니다. "타이타닉 데이터 EDA에서 어떤 것을 보면 좋을지" 제안받아 보죠.

```python
eda_ideas_request = (
    "타이타닉 승객 데이터에 대해 탐색적 데이터 분석(EDA)을 하려고 합니다. "
    "어떤 흥미로운 분석 포인트를 살펴보면 좋을지 제안해주세요. "
    "예를 들어 변수 간 관계나 분포 측면에서 3가지 정도 알려주세요."
)
messages = [
    {"role": "user", "content": eda_ideas_request}
]
response = client.chat.completions.create(model="gpt-4o-mini", messages=messages)
eda_ideas = response.choices[0].message.content
print(eda_ideas)
```

AI가 제안할 EDA 포인트의 예:
```
1. **성별에 따른 생존율 차이:** 남성 vs 여성 중 누가 더 많이 생존했는지 막대그래프로 비교 (타이타닉에서는 여성의 생존율이 높을 것으로 예상).
2. **승객 등급에 따른 생존율:** 1등실, 2등실, 3등실 승객의 생존율을 비교. 등급이 높을수록 생존율이 높을지 확인.
3. **나이 분포와 생존 관계:** 생존자와 사망자의 나이 분포를 히스토그램이나 커널밀도 그래프로 겹쳐서 비교. 어린이의 생존율이 높았는지 등 확인.
```

이런 식으로 3가지를 뽑아줄 가능성이 높습니다. (물론 AI의 답변 형식에 따라 다를 수 있지만, 일반적으로 많이 거론되는 EDA 주제입니다.)

이 제안들을 보면, 우리가 흔히 타이타닉 데이터로 하는 EDA와 일치합니다:
- 여성 생존율 > 남성 생존율 (women and children first 원칙)
- 1등실 생존율 > 3등실 생존율
- 어린이 생존율 높음 등

이제 이 중 하나씩 실행해보겠습니다.

#### (b) 시각화 및 분석 1: 성별에 따른 생존율

먼저 **성별에 따른 생존율**을 확인해보겠습니다. AI가 막대그래프로 비교하라고 제안했으니, 그렇게 해보죠. AI에게 바로 **코드 생성을 부탁**할 수도 있지만, 이번에는 우리가 한번 작성해보고 필요시 AI 도움을 받는 형태로 하겠습니다 (이미 AI가 제안으로 힌트를 줬으니, 직접 해보는 것도 연습).

```python
# 성별에 따른 생존율 계산
survival_by_gender = titanic_df.groupby('sex')['survived'].mean()  # 남/여 생존율 (0-1 사이 값)
print(survival_by_gender)

# 막대그래프로 시각화
survival_by_gender.plot(kind='bar', color=['tomato','skyblue'])
plt.ylabel('Survival Rate')
plt.title('Survival Rate by Sex')
plt.xticks(rotation=0)
plt.show()
```

위 코드를 실행하면, 남성과 여성의 생존율을 막대그래프로 볼 수 있습니다. 결과를 해석해보면:
- 예상대로 `female`의 막대가 `male`보다 훨씬 높을 것입니다 (타이타닉에서 여성 생존율 약 74%, 남성 생존율 약 19%로 알려져 있음).
- 따라서 "여성이 남성보다 생존율이 높다"는 결론을 얻습니다.

이러한 통찰을 AI에게 **검증 및 추가 설명**을 부탁할 수도 있습니다. 예를 들어 AI에게 "위 그래프 결과를 설명해줘"라고 하면, 수치를 근거로 이유를 추론해줄 것입니다 (여성 우선 구조 정책 등을 언급할 수 있음).

#### (c) 시각화 및 분석 2: 등급(Pclass)에 따른 생존율 (교차분석)

다음으로 **객실 등급별 생존율**을 보겠습니다. 여기서는 단순 등급뿐 아니라, **등급과 성별을 교차**하여 좀 더 상세히 보겠습니다 (AI 제안에는 없었지만 흔히 하는 분석이고, 재미있는 패턴이 있는 부분입니다). 이는 **두 개의 범주형 변수에 따른 생존율**을 피벗테이블 형태로 볼 수 있습니다.

AI에게 직접 "등급과 성별에 따른 생존율을 피벗 형태로 보여줘"라고 요청해보겠습니다.

```python
cross_request = (
    "타이타닉 데이터에서 Pclass(객실 등급)와 Sex(성별)에 따른 생존율을 알고 싶습니다. "
    "이 두 가지 기준의 조합별 생존율을 계산하여 표 형태로 보여주세요."
)
messages = [
    {"role": "user", "content": cross_request}
]
response = client.chat.completions.create(model="gpt-4o-mini", messages=messages)
print(response.choices[0].message.content)
```

AI는 pandas의 pivot_table이나 groupby를 활용한 결과를 제시할 것입니다. 예를 들면 출력 형식으로:

```
| Pclass | Sex    | Survival Rate |
| ------ | ------ | ------------- |
| 1      | male   | 0.37          |
| 1      | female | 0.96          |
| 2      | male   | 0.15          |
| 2      | female | 0.92          |
| 3      | male   | 0.13          |
| 3      | female | 0.50          |
```

(수치는 예시이지만 실제 데이터에서 1등실 여성 생존율이 매우 높고, 3등실 남성 생존율이 낮은 것으로 알려져 있습니다.)

또는 AI가 위 표를 말로 표현할 수도 있습니다: "1등실 여성은 거의 대부분 생존(약 95%), 3등실 남성은 매우 생존율 낮음(약 13%)..." 등.

결과를 보면 흥미로운 점:
- **등급 높을수록 생존율 증가** (1등석 > 3등석), 
- **여성이 남성보다 높다**, 
- 이 두 효과가 합쳐져서 1등실 여성은 거의 다 살고 3등실 남성은 거의 못 살았습니다.

이런 교차분석은 EDA에서 중요한 통찰을 줍니다. 

우리가 AI에게 표를 받았지만, 직접 **시각화**해보면 더 직관적입니다. 예를 들어 seaborn의 **분포형 그래프**(카운트플롯 등을 survived를 hue로) 혹은 **모자이크 plot** 등을 생각해볼 수 있지만, 시간상 표로 확인하는 것으로 충분합니다. 

#### (d) 시각화 및 분석 3: 나이 분포와 생존의 관계

마지막으로 AI 제안의 세 번째, **나이와 생존 관계**를 보겠습니다. 이는 연속형 변수(나이)와 범주형 변수(생존)의 관계입니다. 시각화 방법으로는 **커널 밀도 그래프**나 **히스토그램**을 생존여부별로 겹쳐 그리는 것을 생각할 수 있습니다.

AI에게 이 부분은 직접 요청해서 코드를 받아보죠. 

```python
age_plot_request = (
    "타이타닉 데이터에서 생존자와 사망자의 나이 분포를 비교하고 싶습니다. "
    "두 그룹의 Age 분포를 하나의 그래프에 겹쳐 그리는 파이썬 코드를 제공해주세요. "
    "seaborn의 kdeplot을 사용하면 좋겠습니다."
)
messages = [
    {"role": "user", "content": age_plot_request}
]
response = client.chat.completions.create(model="gpt-4o-mini", messages=messages)
age_code = response.choices[0].message.content
print(age_code)
```

AI는 seaborn의 `kdeplot` (커널 밀도 추정 그래프)으로 생존 여부에 따른 분포를 그리는 코드를 줄 것입니다. 예시 코드:

```python
import seaborn as sns
import matplotlib.pyplot as plt

# 생존 여부에 따라 나이 분포 시각화 (커널 밀도)
sns.kdeplot(data=titanic_df[titanic_df['survived']==1], x='age', fill=True, label='Survived')
sns.kdeplot(data=titanic_df[titanic_df['survived']==0], x='age', fill=True, label='Did not survive')
plt.legend()
plt.title('Age Distribution: Survived vs Did Not Survive')
plt.xlabel('Age')
plt.ylabel('Density')
plt.show()
```

(실제 AI 출력에 따라 약간 다를 수 있지만, 대동소이할 것입니다.)

이 그래프를 보면:
- 어린이(나이가 어린 쪽) 부분에서 생존자 곡선이 상대적으로 높게 나타날 것입니다 (어린 승객의 생존률 높음).
- 20~40대 성인에서 사망자 분포가 두드러질 수도 있습니다 (남성 승객 다수).
- 전반적으로 나이대가 높아질수록 생존 확률이 어떻게 변했는지 형태를 볼 수 있습니다 (타이타닉에서는 어린이 우선 탈출 원칙으로 10세 미만 생존율 높았던 것으로 알려짐).

이렇게 **연속형 변수의 분포 비교**도 EDA에서 중요한 부분인데, AI가 코드를 제시해주니 편리하게 시각화를 수행할 수 있습니다.

#### 3. EDA 결과 종합 및 정리

EDA를 진행하며 **AI의 도움**으로 빠르게 시각화와 계산을 해보았습니다. 얻은 주요 결과를 종합하면:
- **성별 생존율:** 여성 >> 남성 (현저한 차이)
- **등급 생존율:** 1등급 > 2등급 > 3등급 (특히 3등급 남성 매우 취약)
- **나이 분포:** 어린이 생존률 높고, 장년층 남성 사망자 많음 (추측 가능)

이런 결과들은 역사적 사실과 부합하기도 하고, 데이터로부터 직접 확인한 통찰입니다.

AI 도구를 사용하지 않고도 할 수 있는 분석이지만, **AI를 통해 얻은 제안과 코드를 활용**함으로써 훨씬 빠르게 EDA 과정을 수행할 수 있었습니다. 특히:
- 초반에 AI가 **중요 EDA 포인트**를 짚어주어 분석 방향을 잡는 데 도움이 되었고,
- 개별 그래프 코드를 일일이 기억하지 않아도 AI가 **문법과 함수를 정확히 작성**해주어 시행착오를 줄일 수 있었습니다.
- 또한, 결과에 대한 **해석도 AI에게 물어볼 수 있다는 점**을 기억하세요. (시간상 직접 묻지는 않았지만, AI에게 "이 결과를 해석해줘"라고 하면 데이터 과학자로서 통찰을 풀어줄 것입니다.)

마지막으로, **EDA 결과를 마무리**하며 AI에게 요약이나 레포트 작성을 돕게 할 수도 있습니다. 예를 들어 "이번 EDA에서 발견된 주요 인사이트를 bullet point로 정리해줘"라고 하면 위의 내용들을 정리해줄 것입니다. 하지만 그 부분은 2일차의 "보고서 작성" 시간에 더 자세히 다룰 예정이므로 여기서는 언급만 하겠습니다.

### 실습 수행 안내

이제 여러분 각자가 **직접 데이터 전처리와 EDA를 진행**해보는 시간입니다. 다음을 참고하여 실습을 수행하세요:

1. **데이터 준비:** 타이타닉 데이터를 사용하거나, 미리 준비된 다른 데이터셋을 사용해도 됩니다. 데이터셋에 대한 사전 이해를 갖추세요 (변수 의미 등).
2. **전처리 단계:** 
   - 데이터의 결측치, 이상치를 확인합니다 (`df.info()`, `df.describe()` 활용).
   - 한두 가지 전처리 작업을 AI에게 문의합니다. (예: "X 컬럼에 결측치가 있는데 채우는 방법?", "Y 컬럼의 이상치를 식별하는 방법?") 
   - AI가 제안한 방법 중 하나를 선택하여 적용합니다. 코드를 직접 작성하거나 AI에게 생성시켜도 좋습니다.
3. **EDA 계획 수립:** 
   - 분석하고자 하는 질문을 2~3개 정합니다. (AI 제안 참고 혹은 자율 선정) 
   - 각 질문에 대해, 필요한 그래프나 수치를 생각해보고, **어떻게 구현할지 구상**합니다.
   - 필요하면 AI에게 "이런 그래프를 그리려면 어떻게 해야 하나?" 묻거나, 바로 코드 생성을 요청하세요.
4. **EDA 실행:** 
   - 정한 분석 포인트에 대해 코드를 실행하고 결과를 확인합니다. (ex: 성별에 따른 평균 비교, 상관관계 행렬 그리기 등 무엇이든 가능합니다)
   - 결과 그래프나 수치를 해석하고 메모합니다. AI에게 해석을 물어보는 것도 가능합니다.
5. **추가 탐색:** 
   - EDA 중 더 궁금해진 사항이 있으면 AI에게 질문을 추가로 던져보세요. (예: "Z 변수와 생존 여부도 관계가 있을까요? 어떤 그래프를 보면 될까요?")
   - 새로운 분석을 하나 정도 더 시도해봅니다.
6. **결과 정리:** 
   - 주요 발견 내용을 요약합니다. 필요시 AI에게 요약 정리를 부탁할 수 있습니다. (예: "이번 분석에서 알게 된 3가지 사실을 요약해줘")

실습을 진행하면서, **AI를 마치 페어 프로그래머 겸 도메인 전문가처럼 활용**해 보시기 바랍니다. 